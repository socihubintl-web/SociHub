<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Checking Table ‚Äî ‚Ç¶300/day</title>
<style>
  :root {
    --accent: #00ffcc;
    --accent-opaque: #00ffcc33;
    --max-width: 780px;
  }
  body{
    font-family: Poppins, system-ui, sans-serif;
    margin:0;
    background:#f4f7f6;
    padding:24px;
    color:#0b0b0b;
    -webkit-font-smoothing:antialiased;
  }
  .wrap{
    max-width:var(--max-width);
    margin:0 auto;
  }
  .card{
    background:#fff;
    border-radius:12px;
    padding:18px;
    box-shadow:0 6px 22px rgba(3,10,10,0.06);
  }
  h1{ margin:0 0 12px 0; font-size:20px; letter-spacing:0.2px }
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:12px;
  }
  th,td{
    padding:10px 8px;
    text-align:center;
    border-bottom:1px solid #eee;
    font-size:14px;
  }
  thead th{ background:var(--accent); color:#000; font-weight:600; }
  .today td{ background:var(--accent-opaque); border-left:4px solid var(--accent); font-weight:600; }
  .blocked td{ background:#fafafa; color:#9aa; }
  .status { font-weight:600; }
  .controls label { margin-right:10px; user-select:none; }
  input[type=checkbox] { transform:scale(1.05); margin-right:6px; }
  button {
    background:var(--accent);
    color:#000;
    border:none;
    padding:10px 14px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    margin:6px 6px 0 0;
  }
  .muted { color:#666; font-size:13px; margin-top:8px; }
  .summary { display:flex; justify-content:space-between; align-items:center; margin-top:14px; gap:8px; flex-wrap:wrap; }
  .view-history { background:#fff; border:1px solid #ddd; padding:8px 12px; border-radius:8px; cursor:pointer; }
  .small { font-size:13px; color:#555; }

  /* modal */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:60; align-items:center; justify-content:center; padding:20px; }
  .modal.open { display:flex; }
  .modal-card { width:100%; max-width:520px; background:#fff; border-radius:12px; padding:18px; max-height:84vh; overflow:auto; box-shadow:0 8px 30px rgba(2,10,10,0.12); }
  .modal-head { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .close-x { cursor:pointer; color:#666; font-weight:700; font-size:20px; }
  .past-week { margin:8px 0; padding:8px 0; }
  .hr { height:1px; background:#eee; margin:10px 0; border-radius:2px; }

  /* responsive */
  @media (max-width:520px){
    th,td{ padding:8px 6px; font-size:13px; }
    button{ padding:8px 10px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Daily Checking Table ‚Äî ‚Ç¶300 / day</h1>
      <div class="muted">Mon‚ÄìFri active. Saturday & Sunday are blocked.</div>

      <table aria-label="Daily checks">
        <thead>
          <tr><th>Day</th><th>Check</th><th>Uncheck</th><th>Status</th></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>

      <div class="summary">
        <div class="small"><strong>Weekly total:</strong> ‚Ç¶<span id="weeklyTotal">0</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="viewPastBtn" class="view-history">View Past Weeks</button>
          <div class="small">Week: <span id="weekLabel"></span></div>
        </div>
      </div>
      <div class="muted">Notes: Future days are locked until that day arrives. If you open the app and missed past checks you‚Äôll be prompted.</div>
    </div>
  </div>

  <!-- Missed-days Modal -->
  <div id="missedModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card" role="document">
      <div class="modal-head">
        <h3 id="missedTitle">Missed checkings</h3>
        <div class="close-x" id="missedClose">&times;</div>
      </div>

      <div id="missedList" style="margin-top:10px"></div>

      <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap;">
        <button id="checkAllBtn" style="display:none">Check All</button>
        <button id="checkOneBtn" style="display:none">Check</button>
        <button id="forgetBtn" style="background:#ff6b6b">Forget</button>
      </div>
      <div class="muted" style="margin-top:10px">Action will affect only the missed days listed above.</div>
    </div>
  </div>

  <!-- Past weeks modal -->
  <div id="pastModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Past Weeks</h3>
        <div class="close-x" id="pastClose">&times;</div>
      </div>

      <div id="pastContent" style="margin-top:12px"></div>
      <div class="hr"></div>
      <div style="text-align:center; font-weight:700; color:#0a7f66">Grand total: ‚Ç¶<span id="grandTotal">0</span></div>
    </div>
  </div>

<script>
/* -----------------------
   App configuration
   ----------------------- */
const DAILY_PRICE = 300;
const DAYS = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
const STORAGE_KEY = "dailyChecks_v1";
const PAST_KEY = "pastWeeks_v1";

/* -----------------------
   Helpers
   ----------------------- */
function getWeekKey(date = new Date()){
  // ISO-like week key but simple: year-W<weekNumber>
  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
  const oneJan = new Date(d.getFullYear(),0,1);
  const daysSince = Math.floor((d - oneJan) / (24*60*60*1000));
  const weekNum = Math.ceil((daysSince + oneJan.getDay() + 1)/7);
  return `${d.getFullYear()}-W${weekNum}`;
}
function dayNameFromIndex(idx){ return DAYS[idx]; } // JS getDay() -> 0 Sun .. 6 Sat
function vibrate(pattern = [40]) { if (navigator.vibrate) navigator.vibrate(pattern); }

/* -----------------------
   Storage + state
   ----------------------- */
let saved = JSON.parse(localStorage.getItem(STORAGE_KEY)) || null;
let pastWeeks = JSON.parse(localStorage.getItem(PAST_KEY)) || [];
const today = new Date();
const todayIndex = today.getDay(); // 0 = Sunday, ... 6 = Saturday
const weekKey = getWeekKey(today);
document.getElementById('weekLabel').textContent = weekKey;

// Start new week if needed
if (!saved || saved.week !== weekKey) {
  if (saved && saved.week) {
    // archive previous week
    pastWeeks.push(saved);
    localStorage.setItem(PAST_KEY, JSON.stringify(pastWeeks));
  }
  saved = { week: weekKey, checks: {} }; // checks: { "Monday": "checked"/"unchecked"/"forgotten" }
  localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
}

/* -----------------------
   UI elements
   ----------------------- */
const tableBody = document.getElementById('tableBody');
const weeklyTotalEl = document.getElementById('weeklyTotal');
const viewPastBtn = document.getElementById('viewPastBtn');
const missedModal = document.getElementById('missedModal');
const missedList = document.getElementById('missedList');
const missedClose = document.getElementById('missedClose');
const checkAllBtn = document.getElementById('checkAllBtn');
const checkOneBtn = document.getElementById('checkOneBtn');
const forgetBtn = document.getElementById('forgetBtn');

const pastModal = document.getElementById('pastModal');
const pastContent = document.getElementById('pastContent');
const pastClose = document.getElementById('pastClose');
const grandTotalEl = document.getElementById('grandTotal');

/* -----------------------
   Render table rows
   ----------------------- */
function renderTable(){
  tableBody.innerHTML = "";
  let total = 0;

  // Determine current weekday name (Mon..Sun)
  const todayName = dayNameFromIndex((todayIndex + 6) % 7 + 0); 
  // NOTE: simple mapping below instead: JS 0=Sun -> index 6 => Sunday

  for (let i=0; i<7; i++){
    const name = DAYS[i];
    const isWeekend = (i === 5 || i === 6); // Saturday index 5? Wait: DAYS array is Mon..Sun -> index 5=Saturday, 6=Sunday
    const row = document.createElement('tr');

    // Today's detection:
    const jsDay = i === 6 ? 0 : i+1; // convert DAYS index (Mon=0) to JS getDay (Mon -> 1)
    const isToday = (jsDay === todayIndex);

    // locked if future day (weekday after today within Mon-Fri)
    let isFuture = false;
    if (!isWeekend && !isToday) {
      // compute day order Mon=1..Fri=5 relative to today
      const todayWeekdayNumber = (function(){ // 1..5 for Mon..Fri, 0 for weekend
        if (todayIndex === 0 || todayIndex === 6) return null;
        return todayIndex; // Mon=1..Fri=5
      })();
      const dayWeekdayNumber = (i<=4) ? i+1 : null;
      if (todayWeekdayNumber !== null && dayWeekdayNumber !== null) {
        isFuture = dayWeekdayNumber > todayWeekdayNumber;
      } else {
        // if today is weekend, all weekdays that are after last Monday are considered future until their day arrives.
        // Simpler: if today is weekend, treat all weekdays as future except the nearest past weekday.
        // We'll lock future days (i.e., if today is Sat/Sun, none should be enabled)
        isFuture = true;
      }
    }

    // status from saved data
    const st = saved.checks[name]; // "checked" | "unchecked" | "forgotten" | undefined

    // styling
    if (isToday && !isWeekend) row.classList.add('today');
    if (isWeekend) row.classList.add('blocked');

    // status label
    let statusLabel = "‚Äî";
    if (st === 'checked') statusLabel = "‚úîÔ∏è Checked";
    else if (st === 'unchecked') statusLabel = "‚úñ Unchecked";
    else if (st === 'forgotten') statusLabel = "üö´ Forgotten";

    // count total only checked
    if (st === 'checked') total += DAILY_PRICE;

    // render two checkboxes but disable when locked:
    const disabledInputs = (isWeekend || (!isToday && !isFuture && (st === 'checked' || st === 'unchecked' || st === 'forgotten')) || isFuture) ? 'disabled' : '';

    // For past days that have explicit status, make inputs disabled (can't change past decisions)
    // For today's day, inputs enabled.
    // For future days, inputs disabled.
    // For past days with no status (missed), inputs disabled (because user should be prompted via modal).
    // However the user asked past days locked; we follow that: past days locked except handled by modal.

    // Determine which inputs are checked visually:
    const checkChecked = st === 'checked' ? 'checked' : '';
    const uncheckChecked = st === 'unchecked' ? 'checked' : '';

    row.innerHTML = `
      <td>${name}</td>
      <td class="controls">
        <label>
          <input type="checkbox" data-day="${name}" data-type="check" ${checkChecked} ${disabledInputs}>
          Check
        </label>
      </td>
      <td class="controls">
        <label>
          <input type="checkbox" data-day="${name}" data-type="uncheck" ${uncheckChecked} ${disabledInputs}>
          Uncheck
        </label>
      </td>
      <td class="status">${ isWeekend ? 'Blocked' : statusLabel }</td>
    `;
    tableBody.appendChild(row);
  }

  weeklyTotalEl.textContent = total;
  saved.week = weekKey;
  saved.total = total;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
}

/* -----------------------
   Mutual-exclusion & change handling
   ----------------------- */
tableBody.addEventListener('change', (e) => {
  const input = e.target;
  if (!input.dataset || !input.dataset.day) return;
  const day = input.dataset.day;
  const type = input.dataset.type; // check or uncheck

  // Only allow today inputs to be changed (others should be disabled already)
  const jsDayIndex = (function(name){
    // convert day name (Mon) to JS getDay index
    const idx = DAYS.indexOf(name); // 0..6 Mon..Sun
    // map to JS getDay: Mon=>1 ... Sun=>0
    if (idx === 6) return 0;
    return idx + 1;
  })(day);

  if (jsDayIndex !== todayIndex) {
    // safety: revert and ignore
    renderTable();
    return;
  }

  // Set state based on clicked type. Mutually exclusive.
  if (type === 'check') saved.checks[day] = 'checked';
  else if (type === 'uncheck') saved.checks[day] = 'unchecked';

  // save and re-render
  localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
  vibrate([30]);
  renderTable();
});

/* -----------------------
   Missed-days detection + modal logic
   ----------------------- */
function detectMissedDays(){
  // Missed = a past weekday (Mon-Fri) BEFORE today (not including today) that has no explicit entry in saved.checks
  const missed = [];
  // if today is weekend -> treat Mon-Fri before this weekend as past => missed if no status
  for (let i=0; i<=4; i++){ // i: 0..4 => Mon..Fri indices in DAYS
    const dayName = DAYS[i];
    const jsIndex = i+1; // Mon=1..Fri=5
    // Past if jsIndex < todayIndex (and todayIndex is Mon..Fri)
    let isPast = false;
    if (todayIndex >= 1 && todayIndex <=5) {
      isPast = jsIndex < todayIndex;
    } else {
      // today is weekend -> all weekdays are considered past relative to weekend
      isPast = true;
    }
    if (isPast){
      const st = saved.checks[dayName];
      if (st === undefined) missed.push(dayName);
    }
  }
  return missed;
}

function showMissedModalIfNeeded(){
  const missed = detectMissedDays();
  if (missed.length === 0) return; // nothing to do

  // build list text
  missedList.innerHTML = `<div class="small">You missed the following checkings:</div>
                          <div style="margin-top:8px; font-weight:700">${missed.join(', ')}</div>`;

  // show appropriate buttons
  if (missed.length > 1) {
    checkAllBtn.style.display = 'inline-block';
    checkOneBtn.style.display = 'none';
  } else {
    checkAllBtn.style.display = 'none';
    checkOneBtn.style.display = 'inline-block';
  }
  // always show forget
  forgetBtn.style.display = 'inline-block';

  // attach actions (ensure remove old handlers)
  checkAllBtn.onclick = () => {
    missed.forEach(d => saved.checks[d] = 'checked');
    localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
    vibrate([50,20,50]);
    closeMissedModal();
    renderTable();
  };
  checkOneBtn.onclick = () => {
    // mark only today's missing day as checked (in case single missed day might not be today)
    // the spec said: "If one day was missed (check)." so check that single missed day
    const day = missed[0];
    saved.checks[day] = 'checked';
    localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
    vibrate([50,20,50]);
    closeMissedModal();
    renderTable();
  };
  forgetBtn.onclick = () => {
    // mark missed days as 'forgotten' so they won't trigger again and won't award money
    missed.forEach(d => saved.checks[d] = 'forgotten');
    localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
    vibrate([20]);
    closeMissedModal();
    renderTable();
  };

  // show modal
  missedModal.classList.add('open');
}
function closeMissedModal(){ missedModal.classList.remove('open'); }

/* -----------------------
   Past weeks view
   ----------------------- */
function renderPastWeeks(){
  pastContent.innerHTML = "";
  if (!pastWeeks || pastWeeks.length === 0){
    pastContent.innerHTML = "<div class='small'>No past weeks saved yet.</div>";
    grandTotalEl.textContent = "0";
    return;
  }
  let grand = 0;
  pastWeeks.slice().reverse().forEach(w => {
    const total = (w.total || Object.values(w.checks || {}).filter(v => v === 'checked').length * DAILY_PRICE);
    grand += total;
    const html = document.createElement('div');
    html.className = 'past-week';
    html.innerHTML = `<div style="font-weight:700">${w.week} ‚Äî ‚Ç¶${total}</div>
      <div class="small">${Object.entries(w.checks || {}).map(([day,st])=>{
        const label = st === 'checked' ? '‚úî' : (st === 'unchecked' ? '‚úñ' : (st === 'forgotten' ? 'üö´' : '‚Äî'));
        return `${day}: ${label}`;
      }).join(' | ')}</div>`;
    pastContent.appendChild(html);
  });
  grandTotalEl.textContent = grand;
}

/* -----------------------
   Modal close handlers
   ----------------------- */
missedClose.onclick = closeMissedModal;
pastClose.onclick = () => pastModal.classList.remove('open');

/* -----------------------
   View Past button
   ----------------------- */
viewPastBtn.addEventListener('click', () => {
  renderPastWeeks();
  pastModal.classList.add('open');
  vibrate([20]);
});

/* -----------------------
   Page init
   ----------------------- */
renderTable();
setTimeout(()=> showMissedModalIfNeeded(), 300); // small delay so UI draws first

/* -----------------------
   Accessibility: close on click-outside for modals
   ----------------------- */
window.addEventListener('click', (e) => {
  if (e.target === missedModal) closeMissedModal();
  if (e.target === pastModal) pastModal.classList.remove('open');
});
</script>
</body>
</html>